$def with (pin, userprofile,presentuser)

<div class="container-fluid pin" id="showdelete_$pin['key']" username="$userprofile['user']['key']" name="$pin['key']">
    <a href="#detail_$pin['key']" data-toggle="modal"><img src="/thumbnail/$pin['key']"
                                                           userkey="$userprofile['user']['key']" name="$pin['key']"
                                                           onclick="getid(this)" width="260px" height="180px"/>
    </a>
    <div>$pin['introduction'][0:125]</div>
</div>

<div id="detail_$pin['key']" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
     aria-hidden="true" style="margin-top:-50px;width:1000px;left:393px;overflow:auto;display:none">
    <div class="modal-header">
        <table style="margin:0px auto" border="1px solid red">
            <tr>
                <td rowspan="2">
                    <div>作者:$userprofile['user']['username']</div>
                </td>
                <td width="200px"></td>
                <td>
                    <button name="" class="btn attentions" type="button" onclick="watchit(this)"
                            title="$userprofile['user']['key']">关注
                    </button>
                </td>
                <td>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
                </td>
            </tr>
            <tr>
                <td width="200px" height="40px"></td>
                <td colspan="2">用户介绍</td>
            </tr>
        </table>

    </div>
    <div style="height:300px;">
        <div class="modal-body">
            <img style="height: 300px; margin-top: -15px;"
                 src="http://192.168.1.165:8080/attachments/source/$pin['key']">
        </div>
    </div>
    <div class="modal-footer">
        <form id="comment_form_$pin['key']" action="" method="post">
            <div class="show_comment" id="show_comment_$pin['key']"
                 style="border:1px solid red;height:80px;overflow:auto"></div>
            <div class="write_comment" style="display:none">
                <textarea id="comment_content_$pin['key']" class="comment_content" rows="0" style="width: 420px">
                </textarea>
            </div>
            <p style="margin-left:120px;margin-top:10px ">
                <button class="btn comment" type="button" onclick="comment(this)">添加评论</button>
                <button onclick="decide(this)" class="btn btn-info decide" name="$pin['key']" type="button">确认</button>
            </p>
        </form>
    </div>
</div>
<script type="text/javascript">
    var flag = true;
    function getid(obj) {
        var presentuser = ("$presentuser['user']['key']");
        var $$keyid = $$(obj).attr("name");
        var $$userid = $$(obj).attr("userkey");
        if (presentuser === $$userid) {
            $$(".attentions").hide();
        }

        $$.get("/follow/oneuser",
                {
                    user_id: $$userid
                },
                function (data, textStatus) {
                    eval("var relationshipId = " + data + ";");
                    if (relationshipId.relationship_id == 'followed') {
                        $$(".attentions").text("取消关注");
                        flag = false;
                    }
                });
        $$.get("/comment/show",
                {
                    img_key_id: $$keyid
                },
                function (data, textStatus) {
                    eval("var content = " + data + ";");
                    for (var i = 0; i < content['comments'].length; i++) {
                        var jhtml = $$(content['comments'][i]);
                        $$("#show_comment_" + $$keyid + "").append(jhtml);
                    }
                }
        );
        $$(".show_comment").html("");
    }

    function watchit(obj) {
        if (flag) {
            var $$userid = $$(obj).attr("title");
            $$.get("/follow/oneuser",
                    {
                        user_id: $$userid
                    },
                    function (data, textStatus) {
                        $$(obj).text("取消关注");
                        flag = false;
                    });
        }
        else {
            $$relationship_id = $$(obj).attr("title");
            $$.get("/unfollow/oneuser",
                    {
                        user_id: $$relationship_id
                    },
                    function (textStatus) {
                        alert("取消成功");
                        $$(obj).text("关注");
                        flag = true;
                    });
        }
    }
    function comment(obj) {
        $$(".comment_form").val("");
        $$(obj).parent().prev().show();
    }
    function decide(obj) {
        var username = "$presentuser['user']['username']";
        var $$img_key_id = $$(obj).attr("name");
        var $$content = $$("#comment_content_" + $$img_key_id + "").val();
        $$(".write_comment").fadeOut();
        if ($$content != "") {
            var $$p = $$("<p style='text-align:left'><span>" + username + "</span>:&nbsp&nbsp" + $$content + "</p>");
            $$(obj).parent().prev().prev().append($$p);
            $$.post("/comment/upload",
                    {
                        img_key_id: $$img_key_id,
                        content: $$content
                    },
                    function (data, textStatus) {
                    }
            );
        }
        $$(".comment_form").val("");
    }
</script>


