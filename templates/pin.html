$def with (pin, userprofile,presentuser)

<div class="container-fluid pin" id="$pin['key']_showdelete">
     
    <a href="#detail" data-toggle="modal"><img src="/thumbnail/$pin['key']" id="$pin['key']" onclick="getid(this)"  width="260px" height="180px" />
    </a>
    
    <div>$pin['introduction'][0:125]</div>
    <div id="$pin['key']_delete" style="position:relative；left: -103px;display:none">
        <button  class="btn" type="button" name="$pin['key']" onclick="delete_a_pin(this)">删除</button>
    </div>
</div>

<div id="detail" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="margin-top:-50px;width:1000px;left:393px;overflow:auto;display:none">
			<div class="modal-header">
                <table style="margin:0px auto" border="1px solid red">
                    <tr>
                        <td rowspan="2" ><div>Author:$userprofile['user']['username']</div></td>
                        <td width="200px"></td>
                        <td><button name=""  class="btn " type="button" onclick="watchit(this)" id="$userprofile['user']['key']">关注</button></td>
                        <td><button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button></td>
                        
                    </tr>
                    
                    <tr>
                                    <td width="200px" height="40px"></td><td colspan="2">用户介绍</td>
                        
                    </tr>
                    
                </table>
 							
			</div>
            <div style="height:300px;overflow:auto">
			        <div  class="modal-body"  >
			            <img src="" >
                        
			        </div>
            </div>
			        <div class="modal-footer">
				        <form id="comment_form" action="" method="post">
						        <div class="show_comment" id="" style="border:1px solid red;height:80px;overflow:auto"></div>
						        <div  class="write_comment" style="display:none" >
							
                                    <textarea  id="comment_content" name="comment_content" rows="0" style="width: 420px" >
														
							        </textarea>
													
												
						        </div>
					        <p style="margin-left:120px;margin-top:10px ">
					        <button  class="btn comment" type="button" onclick="comment(this)">添加评论</button>
					        <button onclick="decide(this)" class="btn btn-info decide" type="button">确认</button>
                            <!--input style="display:none" id="texthidden" type="text" name="keytext" /-->
					        </p>
				        </form>
			        </div>
 </div>
 <script type="text/javascript">

\$("#$pin['key']_showdelete").mouseover(function(){

     var presentuser=("$presentuser['user']['key']");
     var pinauthor=("$userprofile['user']['key']");
     
    if(presentuser==pinauthor)
        {
            
          \$("#$pin['key']_delete").show();

        }

        }).mouseout(function(){

            \$("#$pin['key']_delete").hide();


    })
function delete_a_pin(obj){
      var \$keyid=\$(obj ).attr("name");
       
     
    \$.post("/delete/ownpin",
        {pin_id:\$keyid},
        function(data,textStatus){

       
        \$(obj).parent().parent().hide();

        }

    )

}
    var flag=true;
    function watchit(obj){
 
        if (flag){

                     var \$userid=\$(obj).attr("id");

                      //alert(\$userid);
                       
                     \$.get("/follow/oneuser",
            
                        {
                            user_id:\$userid

                            },
                       function(data,textStatus){
                            
                           
                           eval("var relationshipId = " + data + ";");
                           
                            if(relationshipId.relationship_id=='followed'){

                                    alert("你已经关注了该好友");
                                }
                            else{
    
                                    \$(obj).attr("name",relationshipId.relationship_id);
                            
                                }
                            });
        
                     \$(obj).text("取消关注");
                      flag=false;
                      
                 }
        else{
                     
                    \$relationship_id=\$(obj).attr("name");
                    alert(\$relationship_id);
      
                     \$.get("/unfollow/oneuser",
            
                        {
                            user_id:\$relationship_id

                            },
                       function(textStatus){
                
                            alert("取消成功");
                            
                            });

                      \$(obj).text("关注");
                      flag=true;
                    }
      
    }
       
    function getid(obj){
    
        var \$keyid=\$(obj).attr("id");
       
        \$.get("/comment/show",
    
                {
                    img_key_id:\$keyid

                    },
               function(data,textStatus){
        
                  
                    eval("var content = " + data + ";");
                
     
                    for (var i = 0; i < content['comments'].length; i++)
                    {
                       
                        var jhtml = \$(content['comments'][i]);
                        \$("#show_comment_"+\$keyid+"").append(jhtml);
                    }
        
               }

        );

	    \$("#detail img").attr({"src":"http://192.168.1.165:8080/attachments/source/"+\$keyid+"","id":\$keyid});
	     \$("#detail .show_comment").attr("id","show_comment_"+\$keyid+"");
	    \$("#detail .show_comment").html("");
	
    }
  function comment(obj) {
            var \$img_key_id=\$("#detail img").attr("id");
            
            var index=\$(".comment").index(\$(obj));
		    \$("#comment_form textarea").val("");
             \$(".write_comment").eq(index).fadeIn();
        
    }
  function decide(\$obj) {
        
        var username="$presentuser['user']['username']";
       
        var \$img_key_id=\$("#detail img").attr("id");
	    
	    var \$content=\$("#comment_content").val();
       
        \$(".write_comment").fadeOut();
	  
	    \$("#show_comment_"+\$img_key_id+"").fadeIn();

	    var \$p=\$("<p style='text-align:left'><span>"+username+"</span>:&nbsp&nbsp"+\$content+"</p>");
	    \$("#show_comment_"+\$img_key_id+"").append(\$p);
  
        \$.post("/comment/upload",
                
                     {
                        img_key_id:\$img_key_id,
                        content: \$content

                    }, 

            function(data,textStatus)
                {
                    //alert(textStatus);
                    
                    }
            );

	    \$("#comment_form textarea").val("");
	

    }

</script>

