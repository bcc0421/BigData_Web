$def with (pin, userprofile,presentuser)
<div id="showdelete_$pin['key']" username="$userprofile['user']['key']" name="$pin['key']" >
<div class="container-fluid pin"  >
    
    <a href="#detail_$pin['key']" data-toggle="modal"><img src="/thumbnail/$pin['key']" userkey="$userprofile['user']['key']" name="$pin['key']" onclick="getid(this)"  width="260px" height="180px" />
    </a>
    
    <div>$pin['introduction'][0:125]</div>
    <div id="delete_$pin['key']" style="position:relative;left: -10px;" >
        <a href="#"><button  class="btn" type="button" name="$pin['key']"  onclick="delete_a_pin(this)">删除:所在板块=$pin['board_id']</button></a>
        <button  class="btn" type="button"  name="$pin['key']">下载</button>
    </div>
    
</div>

<div id="detail_$pin['key']" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="margin-top:-50px;width:1000px;left:393px;overflow:auto;display:none">
			<div class="modal-header">
                <table style="margin:0px auto" border="1px solid red">
                    <tr>
                        <td rowspan="2" ><div>Author:$userprofile['user']['username']</div></td>
                        <td width="200px"></td>
                        <!--td><button name=""  class="btn attentions" type="button" onclick="watchit(this)" title="$userprofile['user']['key']">关注</button></td-->
                        <td><button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button></td>
                        
                    </tr>
                    
                    <tr>
                                    <td width="200px" height="40px"></td><td colspan="2">用户介绍</td>
                        
                    </tr>
                    
                </table>
 							
			</div>
            <div style="height:300px;">
			        <div  class="modal-body"  >
			            <img style="height: 300px; margin-top: -15px;"  src="http://192.168.1.165:8080/attachments/source/$pin['key']"  >
                        
			        </div>
            </div>
			        <div class="modal-footer">
				        <form id="comment_form_$pin['key']" action="" method="post">
						        <div class="show_comment" id="show_comment_$pin['key']" style="border:1px solid red;height:80px;overflow:auto">
</div>
						        <div  class="write_comment" style="display:none" >
							
                                    <textarea  id="comment_content_$pin['key']" class="comment_content" rows="0" style="width: 420px" ></textarea>
														
							        
													
												
						        </div>
					        <p style="margin-left:120px;margin-top:10px ">
					        <button  class="btn comment" type="button" onclick="comment(this)">添加评论</button>
					        <button onclick="decide(this)" class="btn btn-info decide" name="$pin['key']" type="button">确认</button>
                            <!--input style="display:none" id="texthidden" type="text" name="keytext" /-->
					        </p>
				        </form>
			        </div>
 </div>


</div>
 <script type="text/javascript">
 /*function saveImageAs (imgOrURL) {
    alert("222222222");
    alert(imgOrURL);
    alert(typeof imgOrURL);
   if (typeof imgOrURL == 'object')
     imgOrURL = imgOrURL.src;
    window.win = open (imgOrURL);
    setTimeout('win.document.execCommand("SaveAs")', 500);
  }
function download(obj){
    alert("123");
    var filename=\$(obj).attr("name");
    var url="http://192.168.1.165:8080/attachments/source/"+filename+"";
    alert("234");

     window.location="http://192.168.1.165:8081/attachment/"+filename+"";
    saveImageAs(obj);
    alert("234222222");
//192.168.1.165:8081/attachment/dd2dbd88-36fc-11e3-9126-000c29fb62b6.flv

}*/

 
function delete_a_pin(obj){
    var \$keyid=\$(obj ).attr("name");
    
     if(confirm("是否确认删除")){
                alert("22");
                \$.post("/delete/ownpin",
                    {pin_id:\$keyid},
                    function(data,textStatus){
                   
                    \$("#showdelete_"+\$keyid+"").empty();
                    });
        }
      else 
        return false;
    }
  var flag=true;
    function getid(obj){
    
        var \$keyid=\$(obj).attr("name");
        var \$userid=\$(obj).attr("userkey");
     
         \$.get("/follow/oneuser",
            
                        {
                            user_id:\$userid

                            },
                       function(data,textStatus){
                            
                         
                           eval("var relationshipId = " + data + ";");
                           
                            if(relationshipId.relationship_id=='followed'){

                                 \$(".attentions").text("取消关注");
                                }
                            
                            });
        
                   
           flag=false;
       
        \$.get("/comment/show",
    
                {
                    img_key_id:\$keyid

                    },
               function(data,textStatus){
        
                   // alert(data);
                    eval("var content = " + data + ";");
                
     
                    for (var i = 0; i < content['comments'].length; i++)
                    {
                       
                        var jhtml = \$(content['comments'][i]);
                        
                       
                        \$("#show_comment_"+\$keyid+"").append(jhtml);
                    }
        
               } );
       
       
            \$(".show_comment").html("");
	
    }

    function watchit(obj){
 
        if (flag){

                     var \$userid=\$(obj).attr("title");

                      //alert(\$userid);
                       
                     \$.get("/follow/oneuser",
            
                        {
                            user_id:\$userid

                            },
                       function(data,textStatus){
                            
                         
                            \$(obj).text("取消关注");
                            flag=false;
                           /*eval("var relationshipId = " + data + ";");
                           
                            if(relationshipId.relationship_id=='followed'){

                                    alert("你已经关注了该好友");
                                }
                            else{
    
                                    \$(obj).attr("name",relationshipId.relationship_id);
                            
                                }*/
                            
                        });
        
                    
                      
                      
                 }
        else{
                     
                    \$relationship_id=\$(obj).attr("title");
                
      
                     \$.get("/unfollow/oneuser",
            
                        {
                            user_id:\$relationship_id

                            },
                       function(textStatus){
                
                            alert("取消成功");
                            \$(obj).text("关注");
                            flag=true;
                            
                            });

                      
                    }
      
    }
 function comment(obj){
        
          \$(".comment_form").val("");
          \$(obj).parent().prev().show();


}
function decide(obj){
    var username="$presentuser['user']['username']";
    var \$img_key_id=\$(obj).attr("name");
    var \$content=\$("#comment_content_"+\$img_key_id+"").val();
  
     \$(".write_comment").fadeOut();
	 if(\$content !=""){
            
        var \$p=\$("<p style='text-align:left'><span>"+username+"</span>:&nbsp&nbsp"+\$content+"</p>");
       
       \$(obj).parent().prev().prev().append(\$p);
        //\$(obj).parent().parent().filter(".show_comment").append(\$p);
        //\$("#$pin['key']_show_comment").append(\$p);
	    //\$("#show_comment_"+\$img_key_id+"").append(\$p);
         \$.post("/comment/upload",
                
                     {
                        img_key_id:\$img_key_id,
                        content: \$content

                    }, 

            function(data,textStatus)
                {
                   // alert(textStatus);
                    
                    }
            );

        }
        \$(".comment_form").val("");

}


</script>

