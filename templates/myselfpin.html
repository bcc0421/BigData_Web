$def with (pin, userprofile,presentuser)
<div id="showdelete_$pin['key']" username="$userprofile['user']['key']" name="$pin['key']">
    <div class="container-fluid pin">

        <a href="#detail_$pin['key']" data-toggle="modal"><img src="/thumbnail/$pin['key']"
                                                               userkey="$userprofile['user']['key']" name="$pin['key']"
                                                               onclick="getid(this)" width="260px" height="180px"/>
        </a>

        <div>$pin['introduction'][0:125]</div>
        <div id="delete_$pin['key']" style="position:relative;left: -10px;">
            <a href="#">
                <button class="btn" type="button" name="$pin['key']" onclick="delete_a_pin(this)">
                    删除:所在板块=$pin['bord_name']
                </button>
            </a>
            <!--<button class="btn" type="button" name="$pin['key']" onclick="download(this)">下载</button>-->
            <a class="btn" href="http://192.168.1.165:8080/attachments/download/$pin['key']" download="$pin['key']\.jpg">下载</a>
                 <select name="board_id" id="pin_board_$pin['key']"style="width:114px ;border-right:none;border-color:black">
                            <option>移动板块至</option>
                            <option>校外教育</option>
                            <option>远程办公</option>
                            <option>智慧之门</option>
                            <option>美容美体</option>
                            <option>情感天地</option>
                            <option>健康管理</option>
                            <option>娱乐人生</option>
                            <option>家政辅导</option>
                            <option>购物天堂</option>
                            <option>职业生涯</option>
                            <option>社区服务</option>
                            <option>公共信息</option>
                        </select>
            <button class="btn" style="height: 30px; margin-top: -11px; border-left: medium none; margin-left: -8px;border-color:black"onclick="move(this)"name="$pin['key']">
                <i class="icon-share-alt"></i>
            </button>
        </div>

    </div>

    <div id="detail_$pin['key']" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
         aria-hidden="true" style="margin-top:-50px;width:1000px;left:393px;overflow:auto;display:none">
        <div class="modal-header">
            <table style="margin:0px auto" border="1px solid red">
                <tr>
                    <td rowspan="2">
                        <div>Author:$userprofile['user']['username']</div>
                    </td>
                    <td width="200px"></td>
                    <!--td><button name=""  class="btn attentions" type="button" onclick="watchit(this)" title="$userprofile['user']['key']">关注</button></td-->
                    <td>
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
                    </td>
                </tr>
                <tr>
                    <td width="200px" height="40px"></td>
                    <td colspan="2">用户介绍</td>
                </tr>
            </table>
        </div>
        <div style="height:300px;">
            <div class="modal-body">
                <img style="height: 300px; margin-top: -15px;"
                     src="http://192.168.1.165:8080/attachments/source/$pin['key']">
            </div>
        </div>
        <div class="modal-footer">
            <form id="comment_form_$pin['key']" action="" method="post">
                <div class="show_comment" id="show_comment_$pin['key']"
                     style="border:1px solid red;height:80px;overflow:auto">
                </div>
                <div class="write_comment" style="display:none">
                    <textarea id="comment_content_$pin['key']" class="comment_content" rows="0"
                              style="width: 420px"></textarea>
                </div>
                <p style="margin-left:120px;margin-top:10px ">
                    <button class="btn comment" type="button" onclick="comment(this)">添加评论</button>
                    <button onclick="decide(this)" class="btn btn-info decide" name="$pin['key']" type="button">确认
                    </button>
                </p>
            </form>
        </div>
    </div>


</div>
<script type="text/javascript">
    function move(obj){
     var $$keyid= $$(obj).attr("name");
     var board_index = $$("#pin_board_" + $$keyid + "").get(0).selectedIndex;
     if(board_index==0){
            alert("请选择模块");

            }else{
                $$.get("/move/pin/" + board_index + "",
                {
                    img_key_id: $$keyid
                },
               function (data, textStatus) {
                        alert("转移成功");
                       // $$("#showdelete_" + $$keyid + "").remove();
                });
               }



    }
    function delete_a_pin(obj) {
        var $$keyid = $$(obj).attr("name");
        if (confirm("是否确认删除")) {
            $$.post("/delete/ownpin",
                    {pin_id: $$keyid},
                    function (data, textStatus) {
                        $$("#showdelete_" + $$keyid + "").empty();
                    });
        }
        else
            return false;
    }
    var flag = true;
    function getid(obj) {
        var $$keyid = $$(obj).attr("name");
        var $$userid = $$(obj).attr("userkey");
        $$.get("/follow/oneuser",
                {
                    user_id: $$userid
                },
                function (data, textStatus) {
                    eval("var relationshipId = " + data + ";");
                    if (relationshipId.relationship_id == 'followed') {
                        $$(".attentions").text("取消关注");
                    }
                });
        flag = false;
        $$.get("/comment/show",
                {
                    img_key_id: $$keyid
                },
                function (data, textStatus) {
                    eval("var content = " + data + ";");
                    for (var i = 0; i < content['comments'].length; i++) {
                        var jhtml = $$(content['comments'][i]);
                        $$("#show_comment_" + $$keyid + "").append(jhtml);
                    }
                });
        $$(".show_comment").html("");
    }
    function watchit(obj) {
        if (flag) {
            var $$userid = $$(obj).attr("title");
            $$.get("/follow/oneuser",
                    {
                        user_id: $$userid
                    },
                    function (data, textStatus) {
                        $$(obj).text("取消关注");
                        flag = false;
                    });
        }
        else {
            $$relationship_id = $$(obj).attr("title");
            $$.get("/unfollow/oneuser",
                    {
                        user_id: $$relationship_id
                    },
                    function (textStatus) {
                        alert("取消成功");
                        $$(obj).text("关注");
                        flag = true;
                    });
        }
    }
    function comment(obj) {
        $$(".comment_form").val("");
        $$(obj).parent().prev().show();
    }
    function decide(obj) {
        var username = "$presentuser['user']['username']";
        var $$img_key_id = $$(obj).attr("name");
        var $$content = $$("#comment_content_" + $$img_key_id + "").val();
        $$(".write_comment").fadeOut();
        if ($$content != "") {
            var $$p = $$("<p style='text-align:left'><span>" + username + "</span>:&nbsp&nbsp" + $$content + "</p>");
            $$(obj).parent().prev().prev().append($$p);
            $$.post("/comment/upload",
                    {
                        img_key_id: $$img_key_id,
                        content: $$content
                    },
                    function (data, textStatus) {
                    }
            );
        }
        $$(".comment_form").val("");
    }
</script>

